<%- @page_title = "eXtension Communities" -%>

<div class="page-header">
  <h2>eXtension Communities and Institutions</h2>
</div>

<div class="row">
  <div class="col-md-6">
    <%= render(:partial => 'communities/find_form') %>
    <p>Can't find a community? <%= link_to("Create a new one",new_community_path)%>.</p>

    <%- if current_person.invited_communities.count > 0 -%>
    <h3>Pending Invitations</h3>
    <ul class="list-unstyled">
      <% current_person.community_invitations.each do |community|%>
        <li>
          <%= community_icon(community) %>
          <%= link_to(community.name,community_url(community)) %>
          <small><%= display_invited_as(community.connectiontype) %></small>
        </li>
      <% end %>
    </ul>
    <%- end -%>

    <%- if current_person.pending_communities.count > 0 -%>
    <h3>Pending Approvals</h3>
     <ul class="list-unstyled">
      <% current_person.pending_communities.each do |community|%>
        <li>
          <%= link_to(community.name,community_url(community)) %>
        </li>
      <% end %>
    </ul>
    <%- end -%>


    <h3>Your Communities and Institutions</h3>
    <%- if current_person.connected_communities.count > 0 -%>

      <ul class="list-unstyled">
        <%- current_person.connected_communities.each do |community| -%>
          <li class="<%= community.is_institution? ? "is_institution" : "is_community" %>">

            <%= link_to(community.name, community) %>
            <small><%= current_person.connection_with_community_expanded(community)%></small>
          </li>
        <%- end -%>
      </ul>
    <%- else -%>
      <p>You haven't yet joined or indicated an interest in any communities</p>
    <%- end -%>

    <h3>Newest Communities</h3>
    <dl class='community'>
      <%- Community.order('created_at DESC').limit(5).each do |community| -%>
      <dt><%= link_to(community.name,community_url(community)) %></dt>
      <dd class='type'><%= community.entrytype_to_s %> - <%= community.memberfilter_to_s %></dd>
      <dd class='description'><%= description_for_community(community) %></dd>
      <%- end -%>
    </dl>
    <p><%= link_to("More...",newest_communities_path)%></p>
  </div>

  <div class="col-md-6">
    <h3>eXtension Communities of Practice</h3>
    <ul class='list-unstyled'>
      <%- Community.approved.order('name ASC').each do |community| -%>
      <li class='community'>
        <span><%= @approved_joined_counts[community.id] || 0 %> joined</span>
        <%= link_to(community.name,community_url(community)) %>
      </li>
      <%- end -%>
    </ul>
  </div>
</div>
