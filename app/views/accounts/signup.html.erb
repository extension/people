<%- @page_title = "Sign up - eXtension" -%>

<div class="page-header">
  <h2>eXension Sign Up <a name="signup_top"></a></h2>
</div>



<div class="row">
  <div class="span8">

    <%= simple_form_for(@person, url: accounts_path, class: 'form-horitzontal') do |f| -%>

      <%- if notification = f.error_notification -%>
        <div class="alert alert-error fade in">
          <a class="close" data-dismiss="alert" href="#">&times;</a>
          <%= notification %>
        </div>
      <%- end -%>
    
      <p><span class="help-block">Fields marked with an asterisk (<em class="required">*</em>) are required</span></p>

      <%- if(!@invitation.nil?) -%>
        <%= hidden_field_tag('invite',@invitation.token) %>
      <%- end -%>

      <fieldset>
        <%= f.input :first_name %>
        <%= f.input :last_name %>
        <%= f.input :email, :input_html => { :class => 'span4' }, :hint =>  "Using a .edu or .gov email address if you have one will speed up account review." %>
        <%= f.input :password, :hint =>  "Minimum 8 characters." %>
        <%= f.input :phonenumber %>
        <%= f.input :title %>
        <%= f.input :time_zone, :priority => ActiveSupport::TimeZone.us_zones, :default => "Eastern Time (US & Canada)", :input_html => { :class => 'span4' }  %>
      </fieldset>

      <fieldset>
        <legend>Your Connection to Extension</legend>
        <%= f.input :involvement, :input_html => { :rows => 3, :class => 'span4' }, :hint =>  "Please list someone in Extension with whom you have a connection, and tell us how you would like to be involved with eXtension." %>
      </fieldset>


      <fieldset>
        <legend>Your Location</legend>
        <%= f.association :location, collection: Location.order('entrytype,name'), include_blank: true %>
        <%= f.association :county, collection: (@person.location.blank? ? [] : @person.location.counties.order("name")), include_blank: true, wrapper_html: { id: 'county_select', style: @person.location.blank? ? 'display:none;' : '' } %>
      </fieldset>

      <fieldset>
        <legend>Your Institution/Affiliation</legend>
      </fieldset>

      <fieldset>
        <legend>Your Position</legend>
      </fieldset>

      <p><%= submit_tag "Sign up", :class => "btn btn-primary" %> <%= link_to "Cancel", root_path, :class => "btn" %></p>


    <%- end # end form -%> 
  </div>

      <div class="span4">
        <div class="well">
        <h4>Registration Help</h4>
        <p><%= link_to('I forgot my password', '#') %></p>
        <p>Already registered? <%= link_to('Sign-in', signin_path) %></p>
        </div>
    </div>
  </div>

  <script type="text/javascript">
    $("#person_location_id").change(function() {     
      $.post('<%= counties_for_location_data_path %>', { location: $(this).val() }, function(data) {
        if(!$.isEmptyObject(data)) {
          $("#county_select").show();
          populateDropdown($("#person_county_id"), data);
        } else {
          $("#county_select").hide();
        }
      });
    });
 
    function populateDropdown(select, data) {
        select.html('');
        $.each(data, function(id, option) {
            select.append($('<option></option>').val(option.id).html(option.name));
        });       
    }
</script>

